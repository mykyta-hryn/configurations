'use strict';

var index = require('../../webpack-bundle-analyzer/lib/index.js');

var bundleAnalyzer =
  ({ enabled = true, openAnalyzer = true } = {}) =>
  (nextConfig = {}) => {
    return Object.assign({}, nextConfig, {
      webpack(config, options) {
        if (enabled) {
          const { BundleAnalyzerPlugin } = index;
          config.plugins.push(
            new BundleAnalyzerPlugin({
              analyzerMode: 'static',
              openAnalyzer,
              reportFilename: options.isServer
                ? '../analyze/server.html'
                : './analyze/client.html',
            })
          );
        }

        if (typeof nextConfig.webpack === 'function') {
          return nextConfig.webpack(config, options)
        }
        return config
      },
    })
  };

module.exports = bundleAnalyzer;
